{
  "pluginType": "DB",
  "pluginId": "mysql-plugin",
  "unpublishedAction": {
    "name": "Sales_Select",
    "datasource": {
      "name": "appsmithmysql",
      "pluginId": "mysql-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "appsmithmysql",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "SalesDashboard",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "SELECT \n    Sales.Id as SalesId, Sales.Number, Sales.Description,\n    Sales.ClientId, Sales.CompanyId,\n    Sales.CurrentState, Sales.BusinessUnitId,\n    Client.Name AS Client, \n    BusinessUnit.Name AS BusinessUnit,\n    SalesManager.Id AS SalesManagerId,\n    SalesManager.UserName AS SalesManager,\n    BusinessManager.Id AS BusinessManagerId,\n    BusinessManager.UserName AS BusinessManager\nFROM Sales \nLEFT JOIN Client ON Sales.ClientId = Client.Id\nINNER JOIN BusinessUnit ON Sales.BusinessUnitId = BusinessUnit.Id\nLEFT JOIN AppUser AS SalesManager ON Sales.SalesManagerId = SalesManager.Id\nLEFT JOIN AppUser AS BusinessManager ON Sales.BusinessManagerId = BusinessManager.Id\nLEFT JOIN UserRole ON SalesManager.Id = UserRole.UserId  \nLEFT JOIN Role ON UserRole.RoleId = Role.Id\nWHERE \n    Role.Name = 'Sales Manager' -- Mandatory condition\n    AND (\n        -- If the user has only the \"Business Manager\" role, apply the filter\n        (\n            '{{appsmith.store.FilterRole}}' = 'BusinessManager'\n            AND BusinessManager.UserName = '{{appsmith.user.username.split('@')[0]}}'\n        )\n        OR\n        -- If the user has the \"Sales Manager\" role, do not apply the filter\n        '{{appsmith.store.FilterRole}}' = 'SalesManager'\n    )\n    AND {{ this.params?.ClientFilter || true }}\n    AND {{ this.params?.SalesManagerFilter || true }} \n    AND Sales.Deleted = 0 \nORDER BY Sales.Id DESC;",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ]
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      " this.params?.ClientFilter || true ",
      " this.params?.SalesManagerFilter || true ",
      "appsmith.store.FilterRole",
      "appsmith.user.username.split('@')[0]"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": [],
    "createdAt": "2024-08-14T07:28:43Z"
  },
  "id": "SalesDashboard_Sales_Select",
  "deleted": false,
  "gitSyncId": "669f3a27b262492468bb49d5_66bc5cabb262492468bb9479"
}